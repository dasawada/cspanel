<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æº–å‚™é€£ç·š</title>
    <style>
        :root {
            --primary-color: #007AFF; /* é€šç”¨ç³»çµ±è— */
            --bg-color: #f2f2f7;
            --card-bg: #ffffff;
            --text-main: #1c1c1e;
            --text-sub: #6c6c70;
            --border-radius: 12px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            line-height: 1.5;
        }

        .container {
            background: var(--card-bg);
            width: 100%;
            max-width: 400px;
            padding: 32px 24px;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            text-align: center;
            display: none; /* JS æ§åˆ¶é¡¯ç¤º */
        }

        h1 {
            font-size: 20px;
            font-weight: 600;
            margin: 0 0 12px 0;
            color: var(--text-main);
        }

        p {
            font-size: 15px;
            color: var(--text-sub);
            margin: 0 0 24px 0;
        }

        .instruction-box {
            background-color: #f5f5f7;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 24px;
            text-align: left;
            font-size: 14px;
        }

        .instruction-step {
            display: flex;
            align-items: flex-start;
            margin-bottom: 8px;
        }
        .instruction-step:last-child { margin-bottom: 0; }
        .icon { margin-right: 10px; font-size: 16px; }

        .btn {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            padding: 14px;
            border-radius: var(--border-radius);
            font-size: 16px;
            font-weight: 500;
            text-decoration: none;
            cursor: pointer;
            box-sizing: border-box;
            border: none;
            transition: opacity 0.2s;
        }
        .btn:active { opacity: 0.7; }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-secondary {
            background-color: transparent;
            color: var(--primary-color);
            margin-top: 12px;
        }
        
        .highlight {
            font-weight: 600;
            color: var(--text-main);
        }

        /* æ–°å¢è¼‰å…¥å‹•ç•« */
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        #view-loading h1::before {
            content: "ğŸ”„";
            display: inline-block;
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body>

    <div id="view-loading" class="container" style="display: block;">
        <h1>ğŸ”„ æ­£åœ¨æº–å‚™...</h1>
        <p>è«‹ç¨å€™</p>
    </div>

    <div id="view-ios" class="container">
        <h1>ğŸ‘‹ æˆ‘å€‘æ›å€‹åœ°æ–¹é€£ç·šå§</h1>
        <p>ç›®å‰çš„ App è¦–çª—ç„¡æ³•é–‹å•Ÿç›¸æ©Ÿèˆ‡éº¥å…‹é¢¨<br>è«‹åˆ‡æ›åˆ°ç€è¦½å™¨ï¼Œé€šè©±æ›´é †æš¢ã€‚</p>
        
        <div class="instruction-box">
            <div class="instruction-step">
                <span class="icon">1ï¸âƒ£</span>
                <span>é»æ“Šè¢å¹•è§’è½çš„é¸å–®ç¬¦è™Ÿ (â‹¯ æˆ– ğŸ§­)</span>
            </div>
            <div class="instruction-step">
                <span class="icon">2ï¸âƒ£</span>
                <span>é¸æ“‡ <span class="highlight">åœ¨ç€è¦½å™¨ä¸­é–‹å•Ÿ</span></span>
            </div>
            <div class="instruction-step" style="margin-top:8px; color:#888; font-size:13px;">
                <span class="icon">ğŸ’¡</span>
                <span>æ¨è–¦ä½¿ç”¨ <strong>Safari</strong> æˆ– <strong>Chrome</strong></span>
            </div>
        </div>

        <button class="btn btn-secondary" onclick="copyLink(this)">è¤‡è£½é€£çµ (æ‰‹å‹•é–‹å•Ÿ)</button>
    </div>

    <div id="view-android" class="container">
        <h1>ğŸš€ æº–å‚™é€²å…¥æœƒè­°</h1>
        <p>ç‚ºäº†ç¢ºä¿é€£ç·šç©©å®šï¼Œ<br>è«‹é¸æ“‡åˆé©çš„ç€è¦½å™¨é–‹å•Ÿã€‚</p>
        
        <div class="instruction-box" style="text-align: center;">
            <span class="icon">âœ…</span>
            è«‹é¸æ“‡ï¼š<span id="android-browser-suggestion" class="highlight">Chrome</span>
        </div>

        <a id="btn-android-enter" href="#" class="btn btn-primary">é–‹å•Ÿç€è¦½å™¨</a>
        <button class="btn btn-secondary" onclick="copyLink(this)">è¤‡è£½é€£çµ</button>
    </div>

    <script>
        // è¨­å®šç›®æ¨™ç¶²å€
        const TARGET_URL = "https://example.com/webrtc"; 

        // æå‡è®Šæ•¸ä½œç”¨åŸŸ
        let isIOS = false;
        let isSamsung = false;
        let isAndroid = false;

        (function() {
            const ua = navigator.userAgent;
            isAndroid = /Android/i.test(ua);
            isIOS = /iPhone|iPad|iPod/i.test(ua);
            isSamsung = /SamsungBrowser|SAMSUNG|SM-/i.test(ua);

            // iOS In-App ç°¡å–®åˆ¤æ–· (Line/FB/IG/Google/GSA)
            const isIOSInApp = isIOS && (/Line\/|FBAV|Instagram|GSA\/|Google\//i.test(ua));

            // Android Line åˆ¤æ–·
            const isAndroidLine = isAndroid && ua.includes("Line/");

            // è¼”åŠ©å‡½å¼:é¡¯ç¤ºå€å¡Š
            function show(id) { 
                document.getElementById("view-loading").style.display = "none";
                document.getElementById(id).style.display = "block"; 
            }

            if (isAndroid) {
                // === Android è™•ç†é‚è¼¯ ===
                show("view-android");

                // 1. æ–‡æ¡ˆå®¢è£½åŒ–ï¼šå¦‚æœæ˜¯ä¸‰æ˜Ÿï¼Œå»ºè­°é¡¯ç¤º Chrome èˆ‡ ä¸‰æ˜Ÿç€è¦½å™¨
                if (isSamsung) {
                    document.getElementById("android-browser-suggestion").innerText = "Chrome æˆ– ä¸‰æ˜Ÿç€è¦½å™¨";
                }

                // 2. è¨­å®šè·³è½‰é€£çµ
                let finalUrl = "#";
                if (isAndroidLine) {
                    // Line ç’°å¢ƒï¼šä½¿ç”¨ Line å°ˆå±¬åƒæ•¸
                    const separator = TARGET_URL.includes('?') ? "&" : "?";
                    finalUrl = TARGET_URL + separator + "openExternalBrowser=1";

                    // å»¶é²è·³è½‰ï¼Œç¢ºä¿ç•«é¢å·²æ¸²æŸ“
                    setTimeout(() => {
                        window.location.href = finalUrl;
                    }, 100);

                    // é¡¯ç¤ºæç¤ºæ–‡å­—
                    document.querySelector("#view-android p").innerHTML = 
                        "æ­£åœ¨ç‚ºæ‚¨é–‹å•Ÿç€è¦½å™¨...<br><small style='color:#888'>è‹¥æœªè‡ªå‹•è·³è½‰,è«‹é»æ“Šä¸‹æ–¹æŒ‰éˆ•</small>";
                } else {
                    // å…¶ä»–ç’°å¢ƒ (å« Google App WebView)ï¼šä½¿ç”¨ Intent å¼·åˆ¶å–šèµ·é¸æ“‡å™¨
                    const cleanUrl = TARGET_URL.replace(/^https?:\/\//, '');
                    finalUrl = "intent://" + cleanUrl + 
                               "#Intent;scheme=https;action=android.intent.action.VIEW;category=android.intent.category.BROWSABLE;end;";
                }
                document.getElementById("btn-android-enter").href = finalUrl;

            } else if (isIOSInApp) {
                // === iOS In-App è™•ç†é‚è¼¯ ===
                show("view-ios");

            } else {
                // === æ­£å¸¸ç€è¦½å™¨ ===
                document.getElementById("view-loading").style.display = "none";
                try {
                    window.location.replace(TARGET_URL);
                } catch (e) {
                    show("view-android");
                    document.querySelector("#view-android h1").innerText = "âš ï¸ ç„¡æ³•è‡ªå‹•è·³è½‰";
                    document.querySelector("#view-android p").innerHTML = 
                        "è«‹é»æ“Šä¸‹æ–¹æŒ‰éˆ•æ‰‹å‹•é–‹å•Ÿ<br><small style='color:#888'>æˆ–è¤‡è£½é€£çµè‡³ç€è¦½å™¨</small>";
                    document.getElementById("btn-android-enter").href = TARGET_URL;
                }
            }
        })();

        const GUIDANCE_MAP = {
            ios: { 
                app: "Safari", 
                icon: "ğŸ§­",
                detail: "é»æ“Šå³ä¸‹è§’åˆ†äº«æŒ‰éˆ• â†’ åœ¨ Safari ä¸­é–‹å•Ÿ"
            },
            samsung: { 
                app: "ä¸‰æ˜Ÿç€è¦½å™¨", 
                icon: "ğŸŒ",
                detail: "é•·æŒ‰é€£çµ â†’ é¸æ“‡ä¸‰æ˜Ÿç€è¦½å™¨é–‹å•Ÿ"
            },
            android: { 
                app: "Chrome", 
                icon: "ğŸŒ",
                detail: "é•·æŒ‰é€£çµ â†’ é¸æ“‡ Chrome é–‹å•Ÿ"
            },
            default: { 
                app: "ç€è¦½å™¨", 
                icon: "ğŸŒ",
                detail: "è²¼ä¸Šè‡³ç€è¦½å™¨ç¶²å€åˆ—"
            }
        };

        function getCurrentGuidance() {
            if (isIOS) return GUIDANCE_MAP.ios;
            if (isSamsung) return GUIDANCE_MAP.samsung; 
            if (isAndroid) return GUIDANCE_MAP.android;
            return GUIDANCE_MAP.default;
        }

        function copyLink(btnElement) {
            const guidance = getCurrentGuidance();
            const originalHTML = btnElement.innerHTML;

            // é¿å…é‡è¤‡é»æ“Š
            if (btnElement.disabled) return;
            btnElement.disabled = true;

            navigator.clipboard.writeText(TARGET_URL)
                .then(() => {
                    btnElement.style.backgroundColor = "#34C759";
                    btnElement.style.color = "#fff";
                    btnElement.innerHTML = `
                        <div style="line-height:1.4">
                            <div style="font-weight:600">âœ… å·²è¤‡è£½é€£çµ</div>
                            <div style="font-size:13px;margin-top:4px;opacity:0.9">
                                ${guidance.icon} è«‹åœ¨ ${guidance.app} è²¼ä¸Š
                            </div>
                        </div>
                    `;

                    // è§¸ç™¼éœ‡å‹•åé¥‹ (æ”¯æ´çš„è£ç½®)
                    if (navigator.vibrate) {
                        navigator.vibrate(50);
                    }

                    setTimeout(() => {
                        btnElement.innerHTML = originalHTML;
                        btnElement.style.backgroundColor = "";
                        btnElement.style.color = "";
                        btnElement.disabled = false;
                    }, 4000);
                })
                .catch(() => {
                    btnElement.disabled = false;
                    // é™ç´šæ–¹æ¡ˆï¼šç›´æ¥é¡¯ç¤ºå¯é¸å–çš„é€£çµ
                    const fallbackMsg = `è«‹æ‰‹å‹•è¤‡è£½ä¸¦åœ¨ ${guidance.app} è²¼ä¸Šï¼š\n\n${TARGET_URL}\n\n${guidance.detail}`;
                    prompt(fallbackMsg, TARGET_URL);
                });
        }
    </script>
</body>
</html>