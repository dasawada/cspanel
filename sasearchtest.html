<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>查找組長的組員</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>
<body>

<h1>查找組長的組員</h1>

<input type="text" id="leaderInput" placeholder="輸入要查找的組長姓名">
<button onclick="findTeamMembers()">查找組員</button>

<div id="searchResults"></div>

<script>
// Google Sheets API 相关信息
const sheetId = "1FcjzaPWepGLRwdwyyefvZs_HEXhC168MircYGqpV9eQ";
const apiKey = "AIzaSyAACAPVwRkK2Ii1nc8oJ8q0ha1ZF3gHlQU";
const endpoint = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/顧問組別清單?key=${apiKey}`;

// 查找功能函数
function findTeamMembers() {
    const leaderName = document.getElementById('leaderInput').value.trim().toLowerCase();

    // 使用 jQuery 发送 GET 请求获取数据
    $.get(endpoint, function(response) {
        console.log(response);

        // 假设 response 是从 Google Sheets API 返回的数据对象
        const values = response.values;

        // 寻找匹配的组长索引
        let columnIndex = -1;
        const leaderRow = values[3]; // 第四行数据，组长信息
        if (leaderRow) {
            columnIndex = leaderRow.findIndex(cell => cell.trim().toLowerCase() === leaderName);
        }

        // 如果找到匹配的组长
        if (columnIndex !== -1) {
            // 遍历所有行，收集该组长的组员
            let teamMembers = [];
            for (let row = 4; row < values.length; row++) {
                if (values[row][columnIndex]) {
                    teamMembers.push(values[row][columnIndex]);
                }
            }

            // 输出结果到页面
            const searchResultsDiv = document.getElementById('searchResults');
            searchResultsDiv.innerHTML = '';

            const resultHeading = document.createElement('h2');
            resultHeading.textContent = `組長 ${leaderName} 的組員有：`;
            searchResultsDiv.appendChild(resultHeading);

            const resultList = document.createElement('ul');
            teamMembers.forEach(member => {
                const listItem = document.createElement('li');
                listItem.textContent = member;
                resultList.appendChild(listItem);
            });
            searchResultsDiv.appendChild(resultList);
        } else {
            // 如果未找到匹配的组长
            const searchResultsDiv = document.getElementById('searchResults');
            searchResultsDiv.innerHTML = '';

            const noResults = document.createElement('p');
            noResults.textContent = `未找到組長 ${leaderName} 的組員。`;
            searchResultsDiv.appendChild(noResults);
        }
    });
}
</script>

</body>
</html>
